<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MergeFlow — Fast PDF Merger</title>
  <meta name="description" content="Merge multiple PDFs securely in your browser. Open‑source, runs on Vercel or GitHub Pages." />
  <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'%3E%3Cpath fill='%23000000' d='M10 18a8 8 0 0 1 8-8h12l8 8h16a8 8 0 0 1 8 8v20a8 8 0 0 1-8 8H18a8 8 0 0 1-8-8z'/%3E%3Cpath fill='%23ffffff' d='M22 30h20v4H22zm0 8h28v4H22z'/%3E%3C/svg%3E" />
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: { display: ["Inter", "ui-sans-serif", "system-ui"], body: ["Inter", "ui-sans-serif", "system-ui"] },
          colors: { brand: { DEFAULT: "#6C5CE7", dark: "#4C3BCF", light: "#A29BFE" } }
        }
      }
    }
  </script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <script src="https://unpkg.com/pdf-lib/dist/pdf-lib.min.js"></script>
  <style>
    .glass { backdrop-filter: blur(10px); background: rgba(255,255,255,.08); }
    .dragging { opacity:.6; transform: scale(.98); }
    .dropzone-dashed { background-image: linear-gradient(to right, rgba(255,255,255,.2) 33%, rgba(255,255,255,0) 0%);
      background-position: bottom; background-size: 8px 2px; background-repeat: repeat-x; }
  </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-brand-dark via-zinc-900 to-black text-white font-body">
  <header class="sticky top-0 z-20 bg-black/30 border-b border-white/10">
    <div class="max-w-6xl mx-auto px-4 py-3 flex items-center gap-3">
      <div class="w-9 h-9 rounded-xl bg-brand flex items-center justify-center font-extrabold">M</div>
      <div class="font-display font-extrabold tracking-tight text-xl">MergeFlow</div>
      <div class="ml-auto flex items-center gap-2 text-sm">
        <a href="#features" class="px-3 py-1.5 rounded-lg hover:bg-white/10">Features</a>
        <a href="#faq" class="px-3 py-1.5 rounded-lg hover:bg-white/10">FAQ</a>
        <a id="upgradeLink" href="#" class="ml-2 px-3 py-1.5 rounded-lg bg-white text-black font-semibold hover:opacity-90">Upgrade</a>
      </div>
    </div>
  </header>

  <section class="max-w-6xl mx-auto px-4 pt-12 pb-6">
    <div class="grid md:grid-cols-2 gap-8 items-center">
      <div>
        <h1 class="text-4xl md:text-6xl font-extrabold leading-tight">Merge PDFs <span class="text-brand-light">instantly</span>, in your browser.</h1>
        <p class="mt-4 text-white/80 text-lg">Drag, reorder, and merge PDFs. Client‑side by default. Use the server for heavier files.</p>
        <div class="mt-6 flex flex-wrap gap-3">
          <button id="ctaScroll" class="px-5 py-3 rounded-xl bg-brand hover:bg-brand-dark transition font-semibold">Start merging</button>
          <a href="#how" class="px-5 py-3 rounded-xl border border-white/20 hover:bg-white/10 transition">How it works</a>
        </div>
        <div class="mt-6 text-xs text-white/60">Open‑source • Runs on Vercel or GitHub Pages • No signup</div>
      </div>
      <div class="glass rounded-3xl p-6 border border-white/10 shadow-2xl">
        <div class="text-sm text-white/70 mb-2">Quick demo</div>
        <div class="aspect-video rounded-2xl bg-black/40 border border-white/10 flex items-center justify-center text-white/50">
          Drop a couple PDFs below and click Merge ▶
        </div>
      </div>
    </div>
  </section>

  <main id="app" class="max-w-6xl mx-auto px-4 pb-24">
    <div class="glass rounded-3xl border border-white/10 p-6 md:p-8 shadow-xl">
      <div class="flex items-center gap-3 mb-4">
        <div class="w-8 h-8 rounded-lg bg-brand flex items-center justify-center font-extrabold">M</div>
        <h2 class="text-2xl font-extrabold">PDF Merger</h2>
        <div class="ml-auto text-sm text-white/60" id="fileCount">No files</div>
      </div>

      <div id="dropzone" class="dropzone-dashed rounded-2xl border-2 border-dashed border-white/20 p-6 text-center cursor-pointer hover:bg-white/5 transition">
        <input id="fileInput" type="file" accept="application/pdf" multiple class="hidden" />
        <div class="flex items-center justify-center gap-3">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="w-6 h-6"><path fill="currentColor" d="M12 3a5 5 0 0 1 5 5v2h1a4 4 0 0 1 0 8h-1v1a3 3 0 0 1-3 3H7a3 3 0 0 1-3-3v-1h1a4 4 0 0 0 0-8h1V8a5 5 0 0 1 5-5m-1 7v3H8l4 4l4-4h-3V10z"/></svg>
          <div>
            <div class="font-semibold">Drop PDFs here or <span class="underline">browse</span></div>
            <div class="text-sm text-white/60">Re‑order after adding</div>
          </div>
        </div>
      </div>

      <ul id="fileList" class="mt-4 space-y-2"></ul>

      <div class="grid md:grid-cols-2 gap-4 mt-6">
        <label class="flex flex-col gap-1">
          <span class="text-sm text-white/70">Output filename</span>
          <input id="outputName" class="px-3 py-2 bg-white/5 border border-white/10 rounded-xl focus:outline-none focus:ring-2 focus:ring-brand" value="merged.pdf" />
        </label>
        <div class="flex flex-col gap-2">
          <label class="flex items-center gap-2 text-sm text-white/80">
            <input id="compressToggle" type="checkbox" class="accent-brand" /> Try to reduce size (experimental)
          </label>
          <label class="flex items-center gap-2 text-sm text-white/80">
            <input id="serverMode" type="checkbox" class="accent-brand" /> Merge on server (beta)
          </label>
        </div>
      </div>

      <div class="mt-6 flex flex-wrap items-center gap-3">
        <button id="mergeBtn" class="px-5 py-3 rounded-xl bg-white text-black font-semibold hover:opacity-90 disabled:opacity-40 disabled:cursor-not-allowed">Merge PDFs</button>
        <button id="clearBtn" class="px-5 py-3 rounded-xl border border-white/20 hover:bg-white/10">Clear</button>
        <div id="status" class="text-sm text-white/70 ml-auto"></div>
      </div>

      <div id="progressWrap" class="hidden mt-4">
        <div class="h-2 w-full bg-white/10 rounded-full overflow-hidden">
          <div id="progressBar" class="h-full w-0 bg-brand-light"></div>
        </div>
        <div id="progressLabel" class="mt-2 text-sm text-white/70">Preparing…</div>
      </div>

      <div id="result" class="hidden mt-6">
        <a id="downloadLink" class="inline-flex items-center gap-2 px-4 py-2 rounded-xl bg-brand hover:bg-brand-dark font-semibold" download>
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="w-5 h-5"><path fill="currentColor" d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8zm-1 1.5V9h5.5zM12 12a1 1 0 0 1 1 1v3h2l-3 3l-3-3h2v-3a1 1 0 0 1 1-1"/></svg>
          <span>Download merged PDF</span>
        </a>
        <span id="finalSize" class="ml-3 text-sm text-white/60"></span>
      </div>
    </div>

    <section id="features" class="mt-16 grid md:grid-cols-3 gap-6">
      <article class="glass rounded-2xl p-5 border border-white/10">
        <h3 class="font-bold mb-1">Private by design</h3>
        <p class="text-white/70 text-sm">Merging can happen locally with <code>pdf-lib</code>. Your PDFs never leave your device unless you enable server mode.</p>
      </article>
      <article class="glass rounded-2xl p-5 border border-white/10">
        <h3 class="font-bold mb-1">Beautiful & fast</h3>
        <p class="text-white/70 text-sm">Sleek UI, drag‑drop, reorder, progress, and instant download.</p>
      </article>
      <article class="glass rounded-2xl p-5 border border-white/10">
        <h3 class="font-bold mb-1">Deploy anywhere</h3>
        <p class="text-white/70 text-sm">Single <code>index.html</code> works on GitHub Pages, Netlify, Vercel — no server needed.</p>
      </article>
    </section>

    <section id="how" class="mt-16 glass rounded-2xl p-6 border border-white/10">
      <h3 class="text-xl font-bold mb-3">How it works</h3>
      <ol class="list-decimal list-inside space-y-1 text-white/80 text-sm">
        <li>Add PDF files via drag‑drop or the browse button.</li>
        <li>Reorder files by dragging each row's handle.</li>
        <li>Click <strong>Merge PDFs</strong>. Choose client or server mode.</li>
        <li>Click <strong>Download merged PDF</strong>.</li>
      </ol>
    </section>

    <section id="faq" class="mt-16 grid md:grid-cols-2 gap-6">
      <div class="glass rounded-2xl p-6 border border-white/10">
        <h3 class="font-bold">Is there a file size limit?</h3>
        <p class="text-white/70 text-sm mt-2">Browsers vary; very large files may be slow. Server mode helps, but serverless functions also have limits.</p>
      </div>
      <div class="glass rounded-2xl p-6 border border-white/10">
        <h3 class="font-bold">Can I run this as a SaaS?</h3>
        <p class="text-white/70 text-sm mt-2">Yes. Add a domain, analytics, and Stripe Payment Links for a "Pro" plan if you want.</p>
      </div>
    </section>

    <footer class="mt-16 text-center text-white/40 text-xs">© <span id="year"></span> MergeFlow. Made with ♥.</footer>
  </main>

  <script>
    const $ = (sel) => document.querySelector(sel);
    const $$ = (sel) => Array.from(document.querySelectorAll(sel));

    // If hosted on Vercel with the API in the same project, this works as-is:
    const BACKEND_URL = "/api/merge";
    // If your frontend is on GitHub Pages, set this to your full Vercel URL instead.

    const state = { items: [], totalBytes: 0 };
    const fileInput = $('#fileInput');
    const dropzone = $('#dropzone');
    const fileList = $('#fileList');
    const fileCount = $('#fileCount');
    const mergeBtn = $('#mergeBtn');
    const clearBtn = $('#clearBtn');
    const statusEl = $('#status');
    const progressWrap = $('#progressWrap');
    const progressBar = $('#progressBar');
    const progressLabel = $('#progressLabel');
    const result = $('#result');
    const downloadLink = $('#downloadLink');
    const finalSize = $('#finalSize');
    const outputName = $('#outputName');
    const compressToggle = $('#compressToggle');
    const serverMode = $('#serverMode');

    $('#year').textContent = new Date().getFullYear();
    $('#ctaScroll').addEventListener('click', () => dropzone.scrollIntoView({behavior:'smooth', block:'center'}));
    dropzone.addEventListener('click', () => fileInput.click());
    dropzone.addEventListener('dragover', (e) => { e.preventDefault(); dropzone.classList.add('bg-white/5'); });
    dropzone.addEventListener('dragleave', () => dropzone.classList.remove('bg-white/5'));
    dropzone.addEventListener('drop', (e) => { e.preventDefault(); dropzone.classList.remove('bg-white/5'); addFiles(e.dataTransfer.files); });
    fileInput.addEventListener('change', (e) => addFiles(e.target.files));
    clearBtn.addEventListener('click', () => { state.items = []; state.totalBytes = 0; renderList(); hideResult(); });

    function addFiles(fileList) {
      if (!fileList?.length) return;
      const arr = Array.from(fileList);
      for (const file of arr) {
        if (file.type !== 'application/pdf') continue;
        const id = crypto.randomUUID();
        const item = { id, file, size: file.size, name: file.name, pages: null, bytes: null };
        state.items.push(item);
        state.totalBytes += file.size;
        file.arrayBuffer().then(async (buf) => {
          item.bytes = buf;
          try {
            const pdf = await PDFLib.PDFDocument.load(buf);
            item.pages = pdf.getPageCount();
          } catch {}
          renderList();
        });
      }
      renderList();
    }

    function renderList() {
      if (state.items.length === 0) {
        fileList.innerHTML = '';
        fileCount.textContent = 'No files';
        mergeBtn.disabled = true;
        return;
      }
      mergeBtn.disabled = false;
      fileCount.textContent = state.items.length + ' file' + (state.items.length>1?'s':'');
      fileList.innerHTML = state.items.map((item, idx) => rowTemplate(item, idx)).join('');
      attachRowHandlers();
    }

    function rowTemplate(item, idx) {
      const sizeKB = (item.size/1024).toFixed(0);
      const pages = item.pages ? `${item.pages}p` : '…';
      return `
        <li class="group bg-white/5 border border-white/10 rounded-xl overflow-hidden" draggable="true" data-id="${item.id}">
          <div class="flex items-center gap-3 p-3">
            <button class="handle cursor-grab active:cursor-grabbing px-2 py-1 rounded-lg bg-white/5 border border-white/10" title="Drag to reorder" aria-label="Drag to reorder">↕</button>
            <div class="flex-1 min-w-0">
              <div class="truncate font-medium">${escapeHtml(item.name)}</div>
              <div class="text-xs text-white/60">${pages} • ${sizeKB} KB</div>
            </div>
            <button class="up px-2 py-1 rounded-lg hover:bg-white/10" title="Move up">↑</button>
            <button class="down px-2 py-1 rounded-lg hover:bg-white/10" title="Move down">↓</button>
            <button class="remove px-2 py-1 rounded-lg bg-red-500/20 hover:bg-red-500/30 border border-red-500/30" title="Remove">✕</button>
          </div>
        </li>`;
    }

    function attachRowHandlers() {
      $$('#fileList li').forEach(li => {
        const id = li.getAttribute('data-id');
        li.addEventListener('dragstart', (e) => { li.classList.add('dragging'); e.dataTransfer.setData('text/plain', id); e.dataTransfer.effectAllowed='move'; });
        li.addEventListener('dragend', () => li.classList.remove('dragging'));
      });
      fileList.addEventListener('dragover', (e) => {
        e.preventDefault();
        const dragging = $('.dragging');
        if (!dragging) return;
        const after = getDragAfterElement(fileList, e.clientY);
        if (after == null) fileList.appendChild(dragging); else fileList.insertBefore(dragging, after);
      });
      fileList.addEventListener('drop', (e) => { e.preventDefault(); syncStateFromDOM(); });
      $$('#fileList .remove').forEach((btn, i) => btn.addEventListener('click', () => { state.totalBytes -= state.items[i].size; state.items.splice(i,1); renderList(); }));
      $$('#fileList .up').forEach((btn, i) => btn.addEventListener('click', () => { if (i>0) { [state.items[i-1], state.items[i]] = [state.items[i], state.items[i-1]]; renderList(); } }));
      $$('#fileList .down').forEach((btn, i) => btn.addEventListener('click', () => { if (i<state.items.length-1) { [state.items[i+1], state.items[i]] = [state.items[i], state.items[i+1]]; renderList(); } }));
    }

    function syncStateFromDOM() {
      const order = $$('#fileList li').map(li => li.getAttribute('data-id'));
      state.items.sort((a,b) => order.indexOf(a.id) - order.indexOf(b.id));
      renderList();
    }

    function getDragAfterElement(container, y) {
      const els = [...container.querySelectorAll('li:not(.dragging)')];
      return els.reduce((closest, child) => {
        const box = child.getBoundingClientRect();
        const offset = y - (box.top + box.height / 2);
        if (offset < 0 && offset > closest.offset) return { offset, element: child };
        else return closest;
      }, { offset: Number.NEGATIVE_INFINITY }).element;
    }

    function escapeHtml(str) { return str.replace(/[&<>"]/g, s => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[s])); }

    mergeBtn.addEventListener('click', async () => {
      if (!state.items.length) return;
      setBusy(true);
      try {
        if (serverMode.checked) {
          await mergeServer();
        } else {
          await mergeClient();
        }
      } catch (e) {
        console.error(e);
        alert('Merge failed. Check the console for details.');
      } finally {
        setBusy(false);
      }
    });

    async function mergeClient() {
      const { PDFDocument } = PDFLib;
      const out = await PDFDocument.create();
      let copied = 0; const total = state.items.length;
      for (let i = 0; i < state.items.length; i++) {
        const item = state.items[i];
        progress(i/total, `Reading: ${item.name}`);
        const bytes = item.bytes || await item.file.arrayBuffer();
        const src = await PDFDocument.load(bytes);
        const pgs = await out.copyPages(src, src.getPageIndices());
        pgs.forEach(p => out.addPage(p));
        copied++;
        progress(copied/total, `Merged ${copied}/${total}`);
      }
      if (compressToggle.checked) {
        try { out.setTitle('Merged with MergeFlow'); out.setProducer('MergeFlow'); } catch {}
      }
      progress(0.98, 'Finalizing…');
      const pdfBytes = await out.save();
      const blob = new Blob([pdfBytes], { type: 'application/pdf' });
      showResult(blob);
    }

    async function mergeServer() {
      const fd = new FormData();
      state.items.forEach(item => fd.append('files', item.file, item.name));
      progress(0.2, 'Uploading…');
      const res = await fetch(BACKEND_URL, { method: 'POST', body: fd });
      if (!res.ok) throw new Error('Server merge failed: ' + res.status);
      progress(0.85, 'Preparing download…');
      const blob = await res.blob();
      showResult(blob);
    }

    function showResult(blob) {
      const url = URL.createObjectURL(blob);
      downloadLink.href = url;
      downloadLink.download = (outputName.value || 'merged') + (outputName.value.endsWith('.pdf') ? '' : '.pdf');
      finalSize.textContent = `(${(blob.size/1024/1024).toFixed(2)} MB)`;
      result.classList.remove('hidden');
      statusEl.textContent = 'Done';
      progress(1, 'Ready to download');
    }

    function setBusy(b) {
      mergeBtn.disabled = b; clearBtn.disabled = b; dropzone.style.pointerEvents = b ? 'none' : '';
      progressWrap.classList.toggle('hidden', !b);
      statusEl.textContent = b ? 'Working…' : '';
      if (!b) { progressBar.style.width = '0%'; progressLabel.textContent = ''; }
    }

    function progress(fraction, label) {
      progressBar.style.width = Math.max(2, Math.floor(fraction*100)) + '%';
      progressLabel.textContent = label || '';
    }

    function hideResult() {
      result.classList.add('hidden');
      finalSize.textContent = '';
      downloadLink.removeAttribute('href');
    }

    document.getElementById('upgradeLink').addEventListener('click', (e) => {
      e.preventDefault();
      alert('Pro coming soon: password protect, page selection, split, image → PDF. Hook this to Stripe Payment Links.');
    });
  </script>
</body>
</html>
